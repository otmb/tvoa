/*

 Titanium Cloud Module

 This module is used across three distinct platforms (iOS, Android, and Mobile Web), each with their own architectural
 demands upon it.

 Appcelerator Titanium is Copyright (c) 2009-2010 by Appcelerator, Inc.
 and licensed under the Apache Public License (version 2)

 Copyright 2008 Netflix, Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined
 in FIPS PUB 180-1
 Version 2.1a Copyright Paul Johnston 2000 - 2002.
 Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 Distributed under the BSD License
 See http://pajhome.org.uk/crypt/md5 for details.
*/
defineCloud(exports);
function defineCloud(r){function x(s,a,n){if(void 0===a)throw"Argument "+s+" was not provided!";if(typeof a!=n)throw"Argument "+s+" was an unexpected type! Expected: "+n+", Received: "+typeof a;}function o(s,a){x("data",s,"object");x("callback",a,"function");y(this);this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json");var n=void 0==r.useSecure?!0:r.useSecure;r.debug&&Ti.API.info('ACS Request: { url: "'+this.url+'", verb: "'+this.verb+'", secure: '+(n?"YES":"NO")+", data: "+JSON.stringify(s)+
" })");t.send(this.url,this.verb,s,n,function(f){if(a){var k=f.response;k||(k={});f.meta&&"ok"==f.meta.status?(k.success=!0,k.error=!1,k.meta=f.meta,r.debug&&Ti.API.info(JSON.stringify(k))):(k.success=!1,k.error=!0,k.code=f.meta?f.meta.code:f.statusCode,k.message=f.meta?f.meta.message:f.message||f.statusText,r.debug&&Ti.API.error(k.code+": "+k.message));a(k)}})}function q(){o.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function z(s){o.call(this,{},
s)}function y(s){s.restNamespace||(s.restNamespace=s.property.toLowerCase());s.restMethod||(s.restMethod=s.method.toLowerCase())}var u={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};u.build=function a(n,f){var k=f.children||[],r;for(r in k)if(k.hasOwnProperty(r)){var j=k[r],q=j.propertyTypes||f.propertyTypes||{};q.children=u.PROPERTY_TYPE_IGNORE;for(var d in f)if(f.hasOwnProperty(d))switch(q[d]||u.PROPERTY_TYPE_ONLY_LATEST){case u.PROPERTY_TYPE_ONLY_LATEST:j[d]=
void 0===j[d]?f[d]:j[d];break;case u.PROPERTY_TYPE_SLASH_COMBINE:var o=[];f[d]&&o.push(f[d]);j[d]&&o.push(j[d]);j[d]=o.join("/")}j.method&&!j.children?n[j.method]=function(a){return function(){return a.executor.apply(a,arguments)}}(j):j.property&&a(n[j.property]={},j)}};u.build(r,{verb:"GET",executor:o,children:[{method:"hasStoredSession",executor:function(){return t.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return t.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",
verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"getChatGroups",restMethod:"get_chat_groups",executor:q}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:q},{method:"show"},
{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:q}]},{property:"Objects",executor:function(a,n){var f;a&&"object"==typeof a&&(x("data.classname",a.classname,"string"),y(this),this.url=this.restNamespace+"/"+a.classname+"/"+this.restMethod+".json",f=a.classname,delete a.classname);o.call(this,a,n);a.classname=f},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},
{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:q},{method:"update",verb:"PUT"},{method:"remove",
restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:q},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",
restMethod:"delete",verb:"DELETE"},{method:"query",executor:q}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:q},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},
{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:z}]},{property:"Statuses",
children:[{method:"create",verb:"POST"},{method:"search"},{method:"query",executor:q}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:z},{method:"search",executor:q},{method:"query",executor:q},{method:"update",verb:"PUT"},{method:"logout",executor:function(a){o.call(this,{},function(n){t.reset();a(n)})}},{method:"remove",restMethod:"delete",verb:"DELETE",executor:function(){var a=arguments;o.call(this,
2==a.length?a[0]:{},function(n){t.reset();(2==a.length?a[1]:a[0])(n)})}},{method:"requestResetPassword",restMethod:"request_reset_password"}]}]});var t=function(){var a;function n(b,e){b[e>>5]|=128<<24-e%32;b[(e+64>>9<<4)+15]=e;for(var c=Array(80),a=1732584193,d=-271733879,i=-1732584194,h=271733878,w=-1009589776,l=0;l<b.length;l+=16){for(var k=a,j=d,n=i,q=h,r=w,p=0;80>p;p++){c[p]=16>p?b[l+p]:(c[p-3]^c[p-8]^c[p-14]^c[p-16])<<1|(c[p-3]^c[p-8]^c[p-14]^c[p-16])>>>31;var o=a<<5|a>>>27,t;t=20>p?d&i|~d&
h:40>p?d^i^h:60>p?d&i|d&h|i&h:d^i^h;o=f(f(o,t),f(f(w,c[p]),20>p?1518500249:40>p?1859775393:60>p?-1894007588:-899497514));w=h;h=i;i=d<<30|d>>>2;d=a;a=o}a=f(a,k);d=f(d,j);i=f(i,n);h=f(h,q);w=f(w,r)}return[a,d,i,h,w]}function f(b,e){var c=(b&65535)+(e&65535);return(b>>16)+(e>>16)+(c>>16)<<16|c&65535}function k(b){for(var e=[],c=(1<<v)-1,a=0;a<b.length*v;a+=v)e[a>>5]|=(b.charCodeAt(a/v)&c)<<32-v-a%32;return e}function q(b,e,c){e?(this.oauthKey=b,this.oauthSecret=e):this.appKey=b;this.apiBaseURL=c?c:a.sdk.url.baseURL;
return this}function j(b,e){var c,a="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(c=Ti.App.Properties.getString(b+"-"+a))&&"undefined"!=c||(c=Ti.App.Properties.getString(b))&&"undefined"!=c?c:e}var o={},d;null==d&&(d={});d.setProperties=function(b,e){if(null!=b&&null!=e)for(var c in e)b[c]=e[c];return b};d.setProperties(d,{percentEncode:function(b){if(null==b)return"";if(b instanceof Array){for(var e="";0<b.length;++b)""!=e&&(e+="&"),e+=d.percentEncode(b[0]);return e}b=
encodeURIComponent(b);b=b.replace(/\!/g,"%21");b=b.replace(/\*/g,"%2A");b=b.replace(/\'/g,"%27");b=b.replace(/\(/g,"%28");return b=b.replace(/\)/g,"%29")},decodePercent:function(b){null!=b&&(b=b.replace(/\+/g," "));return decodeURIComponent(b)},getParameterList:function(b){if(null==b)return[];if("object"!=typeof b)return d.decodeForm(b+"");if(b instanceof Array)return b;var e=[],c;for(c in b)e.push([c,b[c]]);return e},getParameterMap:function(b){if(null==b)return{};if("object"!=typeof b)return d.getParameterMap(d.decodeForm(b+
""));if(b instanceof Array){for(var e={},c=0;c<b.length;++c){var a=b[c][0];void 0===e[a]&&(e[a]=b[c][1])}return e}return b},getParameter:function(b,e){if(b instanceof Array)for(var c=0;c<b.length;++c){if(b[c][0]==e)return b[c][1]}else return d.getParameterMap(b)[e];return null},formEncode:function(b){for(var e="",b=d.getParameterList(b),c=0;c<b.length;++c){var a=b[c][1];null==a&&(a="");""!=e&&(e+="&");e+=d.percentEncode(b[c][0])+"="+d.percentEncode(a)}return e},decodeForm:function(b){for(var e=[],
b=b.split("&"),c=0;c<b.length;++c){var a=b[c];if(""!=a){var g=a.indexOf("="),i;0>g?(i=d.decodePercent(a),a=null):(i=d.decodePercent(a.substring(0,g)),a=d.decodePercent(a.substring(g+1)));e.push([i,a])}}return e},setParameter:function(b,e,c){var a=b.parameters;if(a instanceof Array){for(b=0;b<a.length;++b)a[b][0]==e&&(void 0===c?a.splice(b,1):(a[b][1]=c,c=void 0));void 0!==c&&a.push([e,c])}else a=d.getParameterMap(a),a[e]=c,b.parameters=a},setParameters:function(b,e){for(var c=d.getParameterList(e),
a=0;a<c.length;++a)d.setParameter(b,c[a][0],c[a][1])},completeRequest:function(b,e){null==b.method&&(b.method="GET");var c=d.getParameterMap(b.parameters);null==c.oauth_consumer_key&&d.setParameter(b,"oauth_consumer_key",e.consumerKey||"");null==c.oauth_token&&null!=e.token&&d.setParameter(b,"oauth_token",e.token);null==c.oauth_version&&d.setParameter(b,"oauth_version","1.0");null==c.oauth_timestamp&&d.setParameter(b,"oauth_timestamp",d.timestamp());null==c.oauth_nonce&&d.setParameter(b,"oauth_nonce",
d.nonce(6));d.SignatureMethod.sign(b,e)},setTimestampAndNonce:function(b){d.setParameter(b,"oauth_timestamp",d.timestamp());d.setParameter(b,"oauth_nonce",d.nonce(6))},addToURL:function(b,e){newURL=b;if(null!=e){var c=d.formEncode(e);0<c.length&&(newURL=0>b.indexOf("?")?newURL+"?":newURL+"&",newURL+=c)}return newURL},getAuthorizationHeader:function(b,e){for(var c='OAuth realm="'+d.percentEncode(b)+'"',a=d.getParameterList(e),g=0;g<a.length;++g){var i=a[g],h=i[0];0==h.indexOf("oauth_")&&(c+=","+d.percentEncode(h)+
'="'+d.percentEncode(i[1])+'"')}return c},correctTimestamp:function(b){d.timeCorrectionMsec=1E3*b-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var b=(new Date).getTime()+d.timeCorrectionMsec;return Math.floor(b/1E3)},nonce:function(b){for(var e=d.nonce.CHARS,c="",a=0;a<b;++a)var g=Math.floor(Math.random()*e.length),c=c+e.substring(g,g+1);return c}});d.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";d.declareClass=function(b,a,c){var d=b[a];b[a]=c;if(null!=
c&&null!=d)for(var g in d)"prototype"!=g&&(c[g]=d[g]);return c};d.declareClass(d,"SignatureMethod",function(){});d.setProperties(d.SignatureMethod.prototype,{sign:function(b){var a=this.getSignature(d.SignatureMethod.getBaseString(b));d.setParameter(b,"oauth_signature",a);return a},initialize:function(b,a){var c;c=null!=a.accessorSecret&&9<b.length&&"-Accessor"==b.substring(b.length-9)?a.accessorSecret:a.consumerSecret;this.key=d.percentEncode(c)+"&"+d.percentEncode(a.tokenSecret)}});d.setProperties(d.SignatureMethod,
{sign:function(b,a){var c=d.getParameterMap(b.parameters).oauth_signature_method;if(null==c||""==c)c="HMAC-SHA1",d.setParameter(b,"oauth_signature_method",c);d.SignatureMethod.newMethod(c,a).sign(b)},newMethod:function(b,a){var c=d.SignatureMethod.REGISTERED[b];if(null!=c){var m=new c;m.initialize(b,a);return m}var c=Error("signature_method_rejected"),g="";for(m in d.SignatureMethod.REGISTERED)""!=g&&(g+="&"),g+=d.percentEncode(m);c.oauth_acceptable_signature_methods=g;throw c;},REGISTERED:{},registerMethodClass:function(b,
a){for(var c=0;c<b.length;++c)d.SignatureMethod.REGISTERED[b[c]]=a},makeSubclass:function(b){var a=d.SignatureMethod,c=function(){a.call(this)};c.prototype=new a;c.prototype.getSignature=b;return c.prototype.constructor=c},getBaseString:function(b){var a=b.action,c=a.indexOf("?");if(0>c)c=b.parameters;else for(var c=d.decodeForm(a.substring(c+1)),m=d.getParameterList(b.parameters),g=0;g<m.length;++g)c.push(m[g]);return d.percentEncode(b.method.toUpperCase())+"&"+d.percentEncode(d.SignatureMethod.normalizeUrl(a))+
"&"+d.percentEncode(d.SignatureMethod.normalizeParameters(c))},normalizeUrl:function(b){var a=d.SignatureMethod.parseUri(b),b=a.protocol.toLowerCase(),c=a.authority.toLowerCase();if("http"==b&&80==a.port||"https"==b&&443==a.port){var m=c.lastIndexOf(":");0<=m&&(c=c.substring(0,m))}(a=a.path)||(a="/");return b+"://"+c+a},parseUri:function(b){for(var a="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),b=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(b),
c={},d=14;d--;)c[a[d]]=b[d]||"";return c},normalizeParameters:function(b){if(null==b)return"";for(var a=d.getParameterList(b),b=[],c=0;c<a.length;++c){var m=a[c];"oauth_signature"!=m[0]&&b.push([d.percentEncode(m[0])+" "+d.percentEncode(m[1]),m])}b.sort(function(b,a){return b[0]<a[0]?-1:b[0]>a[0]?1:0});a=[];for(c=0;c<b.length;++c)a.push(b[c][1]);return d.formEncode(a)}});d.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],d.SignatureMethod.makeSubclass(function(){return this.key}));
d.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],d.SignatureMethod.makeSubclass(function(b){u="=";var a=this.key,c=k(a);16<c.length&&(c=n(c,a.length*v));for(var d=Array(16),a=Array(16),g=0;16>g;g++)d[g]=c[g]^909522486,a[g]=c[g]^1549556828;b=n(d.concat(k(b)),512+b.length*v);b=n(a.concat(b),672);c="";for(a=0;a<4*b.length;a+=3){d=(b[a>>2]>>8*(3-a%4)&255)<<16|(b[a+1>>2]>>8*(3-(a+1)%4)&255)<<8|b[a+2>>2]>>8*(3-(a+2)%4)&255;for(g=0;4>g;g++)c=8*a+6*g>32*b.length?c+u:c+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>
6*(3-g)&63)}return c}));var u="",v=8;q.prototype.sendRequest=function(b,e,c,m,g){var i=a.js.sdk.utils.getAuthType(this);if(i==a.constants.unknown)g(a.constants.noAppKeyError);else{var h="",h=m?h+a.sdk.url.https:h+a.sdk.url.http,h=h+(this.apiBaseURL+"/"+a.sdk.url.version+"/"+b);i==a.constants.app_key&&(h+=a.constants.keyParam+this.appKey);c||(c={});e=e?e.toUpperCase():a.constants.get_method;c[a.constants.suppressCode]="true";(m=a.js.sdk.utils.retrieveSessionId())&&(h+=(-1!=h.indexOf("?")?"&":"?")+
a.constants.sessionId+"="+m);m=c;if(Ti.App.analytics){var f=m.analytics||{};f.id=Ti.Platform.createUUID();Ti.Platform.id&&(f.mid=Ti.Platform.id);f.aguid=Ti.App.guid;f.event="cloud."+b.replace(/\//g,".").replace(/\.json/,"");f.deploytype=Ti.App.deployType||"development";f.sid=Ti.App.sessionId;m.ti_analytics=JSON.stringify(f)}c=a.js.sdk.utils.cleanInvalidData(c);if(b=a.js.sdk.utils.getFileObject(c)){try{var l;l=b.toString().match(/TiFilesystemFile/)?b.read():b;if(!l){g(a.constants.fileLoadError);return}c[a.constants.file]?
(delete c[a.constants.file],c[a.constants.file]=l):c[a.constants.photo]&&(delete c[a.constants.photo],c[a.constants.photo]=l)}catch(k){g(a.constants.fileLoadError);return}l={};i==a.constants.oauth&&(h+=(-1!=h.indexOf("?")?"&":"?")+a.constants.oauth_consumer_key+"="+this.oauthKey,i={method:e,action:h,parameters:[]},a.js.sdk.utils.populateOAuthParameters(i.parameters,this.oauthKey),d.completeRequest(i,{consumerSecret:this.oauthSecret}),l.Authorization=d.getAuthorizationHeader("",i.parameters))}else if(l=
{},i==a.constants.oauth){var h=h+((-1!=h.indexOf("?")?"&":"?")+a.constants.oauth_consumer_key+"="+this.oauthKey),i={method:e,action:h,parameters:[]},j;for(j in c)c.hasOwnProperty(j)&&i.parameters.push([j,c[j]]);a.js.sdk.utils.populateOAuthParameters(i.parameters,this.oauthKey);d.completeRequest(i,{consumerSecret:this.oauthSecret});l.Authorization=d.getAuthorizationHeader("",i.parameters)}a.js.sdk.utils.sendAppceleratorRequest(h,e,c,l,g)}};a=void 0;a={constants:{},js:{}};a.js.sdk={};a.js.sdk.utils=
{};a.sdk={};a.sdk.url={};a.sdk.url.http="http://";a.sdk.url.https="https://";a.sdk.url.baseURL="api.cloud.appcelerator.com";a.sdk.url.version="v1";a.constants.app_key=1;a.constants.oauth=2;a.constants.unknown=-1;a.constants.keyParam="?key=";a.constants.file="file";a.constants.photo="photo";a.constants.suppressCode="suppress_response_codes";a.constants.sessionId="_session_id";a.constants.oauth_consumer_key="oauth_consumer_key";a.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}};
a.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}};a.js.sdk.utils.sessionId=null;a.js.sdk.utils.retrieveSessionId=function(){null===a.js.sdk.utils.sessionId&&(a.js.sdk.utils.sessionId=Ti.App.Properties.getString("ACS-StoredSessionId"));return a.js.sdk.utils.sessionId&&"undefined"!=a.js.sdk.utils.sessionId?a.js.sdk.utils.sessionId:null};a.js.sdk.utils.storeSessionId=function(b){b&&(a.js.sdk.utils.sessionId=b,Ti.App.Properties.setString("ACS-StoredSessionId",b))};
a.js.sdk.utils.clearSessionId=function(){a.js.sdk.utils.sessionId=!1;Ti.App.Properties.setString("ACS-StoredSessionId","")};a.js.sdk.utils.getAuthType=function(b){if(b){if(b.appKey)return a.constants.app_key;if(b.oauthKey&&b.oauthSecret)return a.constants.oauth}return a.constants.unknown};a.js.sdk.utils.getFileObject=function(b){if(b)for(var d in b)if(b.hasOwnProperty(d)&&(d==a.constants.photo||d==a.constants.file))return b[d];return null};a.js.sdk.utils.cleanInvalidData=function(b){if(b){for(var a in b)if(b.hasOwnProperty(a)){null==
b[a]&&delete b[a];if("object"==typeof b[a]){var c=JSON.stringify(b[a]);if("{}"==c)continue;if(b[a].nativePath)continue;b[a]=c}if(!0===b[a]||!1===b[a])b[a]=b[a]?1:0}return b}return{}};a.js.sdk.utils.uploadMessageCallback=function(a){return a&&a.data?JSON.parse(a.data):{}};a.js.sdk.utils.getOAuthParameters=function(a){var e="";if(a)for(var a=d.getParameterList(a),c=0;c<a.length;++c){var f=a[c],g=f[0];0==g.indexOf("oauth_")&&"oauth_token"!=g&&(e+="&"+d.percentEncode(g)+"="+d.percentEncode(f[1]))}0<e.length&&
(e=e.substring(1));return e};a.js.sdk.utils.populateOAuthParameters=function(a,e){a&&e&&(a.push(["oauth_version","1.0"]),a.push(["oauth_consumer_key",e]),a.push(["oauth_signature_method","HMAC-SHA1"]),a.push(["oauth_nonce",d.nonce(15)]))};a.js.sdk.utils.sendAppceleratorRequest=function(b,e,c,f,g){var i=Ti.Network.createHTTPClient({timeout:6E4,onsendstream:function(a){r.onsendstream&&r.onsendstream({url:b,progress:a.progress})},ondatastream:function(a){r.ondatastream&&r.ondatastream({url:b,progress:a.progress})},
onerror:function(a){var b={},c=this.responseText;try{var d=c;if(!d||0>=d.length)c=!1;else{for(var d=d.replace(/^\s\s*/,""),e=/\s/,f=d.length;e.test(d.charAt(--f)););c=d.slice(0,f+1)}c&&0<c.length&&(b=JSON.parse(c))}catch(h){b=h}b.message||(b.message=a.error);b.error=!0;b.statusText=this.statusText;b.status=this.status;b.meta&&(b.metaString=JSON.stringify(b.meta));g(b)},onload:function(){var b=JSON.parse(this.responseText);b&&b.meta&&(b.metaString=JSON.stringify(b.meta),a.js.sdk.utils.storeSessionId(b.meta.session_id));
g(b)}}),h=b;switch(e.toUpperCase()){case "DELETE":case "GET":var j="",l;for(l in c)c.hasOwnProperty(l)&&(j+="&"+l+"="+d.percentEncode(c[l]));0<j.length&&(h=0<b.indexOf("?")?h+j:h+("?"+j.substring(1)),c={})}r.debug&&(Ti.API.info(e+": "+h),Ti.API.info("header: "+JSON.stringify(f)),Ti.API.info("data: "+JSON.stringify(c)));i.open(e,h);i.setRequestHeader("Accept-Encoding","gzip,deflate");if(f)for(l in f)f.hasOwnProperty(l)&&i.setRequestHeader(l,f[l]);i.send(c)};var t=null;o.send=function(a,d,c,f,g){if(null==
t){var i=j("acs-api-key",null),h=j("acs-base-url","api.cloud.appcelerator.com"),k=j("acs-oauth-key",null),l=j("acs-oauth-secret",null);if(k&&l)t=new q(k,l,h);else if(i)t=new q(i,null,h);else throw"ACS CREDENTIALS NOT SPECIFIED!";}t.sendRequest(a,d,c,f,g)};o.hasStoredSession=function(){return!!a.js.sdk.utils.retrieveSessionId()};o.retrieveStoredSession=function(){return a.js.sdk.utils.retrieveSessionId()};o.reset=function(){a.js.sdk.utils.clearSessionId();t=null};return o}();return r};